<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>North Pole Connection Terminal</title>
    
    <link rel="prefetch" href="certificate.html">
    <link rel="prefetch" href="mission.html">
    
    <link href="https://fonts.loli.net/css2?family=Cinzel:wght@700&family=Noto+Serif+SC:wght@300;700&family=Ma+Shan+Zheng&family=Special+Elite&display=swap" rel="stylesheet">
    
    <style>
        /* --- æ ¸å¿ƒå¤ä½ä¸å¸ƒå±€ --- */
        body { 
            background-color: #020617; color: #fff; margin: 0; 
            min-height: 100dvh; overflow-x: hidden; 
            font-family: 'Noto Serif SC', serif;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- çº¯CSSå®ç°çš„åŠ è½½åŠ¨ç”» (æ— éœ€JS) --- */
        .intro-container {
            position: fixed; inset: 0; z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 40px; text-align: center;
            background: #020617;
            transition: opacity 1s;
        }

        .typewriter-text {
            font-family: 'Special Elite', monospace; color: #fbbf24; 
            font-size: 1.1rem; line-height: 1.8; 
            text-shadow: 0 0 10px rgba(251, 191, 36, 0.5); 
            text-align: left; margin-bottom: 40px; min-height: 120px;
        }
        
        /* ä½¿ç”¨ CSS åŠ¨ç”»æ¨¡æ‹Ÿæ‰“å­—æœºå…‰æ ‡ï¼Œç¡®ä¿æ²¡ JS ä¹Ÿèƒ½åŠ¨ */
        .cursor { display: inline-block; width: 8px; height: 18px; background: #fbbf24; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        .decrypt-btn { 
            background: transparent; color: #fbbf24; 
            font-family: 'Cinzel', serif; font-size: 1rem; letter-spacing: 2px; 
            text-transform: uppercase; border: 1px solid rgba(251, 191, 36, 0.4); 
            padding: 16px 32px; border-radius: 4px; 
            position: relative; overflow: hidden; cursor: pointer;
            opacity: 0; animation: fadeIn 2s forwards 0.5s; /* çº¯CSSæ¸æ˜¾ */
        }
        @keyframes fadeIn { to { opacity: 1; } }

        /* --- ä¸»ç•Œé¢æ ·å¼ --- */
        #main-stage { opacity: 0; transition: opacity 2s; position: relative; z-index: 10; padding-top: 70px; display: none; }
        
        .video-wrapper {
            width: 100%; max-width: 450px; margin: 0 auto 30px auto;
            border-radius: 12px; overflow: hidden;
            box-shadow: 0 0 40px rgba(251, 191, 36, 0.2);
            border: 1px solid rgba(251, 191, 36, 0.3);
            aspect-ratio: 9/16; background: #000;
        }
        video { width: 100%; height: 100%; object-fit: cover; }

        /* é¡¶éƒ¨æ  */
        .brand-bar {
            position: fixed; top: 0; left: 0; right: 0; height: 60px;
            display: flex; justify-content: center; align-items: center; z-index: 100;
            background: linear-gradient(to bottom, rgba(2,6,23,0.9), transparent);
            pointer-events: none;
            font-family: 'Cinzel', serif; color: #fbbf24; font-weight: bold; text-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
        }

        /* é­”æ³•åº•æ  */
        .magic-dock { 
            position: fixed; right: 20px; bottom: 40px; 
            display: flex; flex-direction: column; gap: 15px; z-index: 5000; 
        }
        .dock-btn {
            width: 44px; height: 44px; border-radius: 50%; 
            display: flex; justify-content: center; align-items: center; font-size: 1.2rem;
            color: #fbbf24; text-decoration: none;
            background: rgba(0, 0, 0, 0.6); border: 1px solid rgba(251, 191, 36, 0.3);
        }

        /* è¾…åŠ©ç±» */
        .gold-text { color: #fbbf24; text-shadow: 0 0 20px rgba(251,191,36,0.3); font-size: 2rem; font-weight: bold; margin-bottom: 10px; font-family: 'Ma Shan Zheng', cursive; text-align: center; }
        .sub-text { font-size: 0.75rem; letter-spacing: 0.2em; color: rgba(254, 243, 199, 0.6); margin-bottom: 2rem; text-align: center; text-transform: uppercase; }
        .skip-btn { display: block; margin: 0 auto; color: #eab308; border-bottom: 1px solid #eab308; padding-bottom: 4px; font-size: 0.875rem; opacity: 0.6; background: none; border-top: none; border-left: none; border-right: none; }
        
        #aurora-bg { position: fixed; inset: 0; z-index: -2; pointer-events: none; }
    </style>
</head>
<body>

    <div class="brand-bar">XHGD Â· SNOWFLAKE KINGDOM</div>

    <div class="intro-container" id="cinema-intro">
        <div class="typewriter-text" id="typewriter-area">
            SYSTEM ID: 2025-XHGD<br>
            Checking connection...<br>
            Signal Verified.<br>
            <span class="cursor"></span>
        </div>
        <button class="decrypt-btn" id="tap-hint" onclick="unlockSystem()">
            â–¼ TAP TO DECRYPT <br> <span style="font-size:0.8rem; opacity:0.8">ç‚¹å‡»è§£å°åŒ—æå¯†è®¯</span>
        </button>
    </div>

    <div id="main-stage">
        <div id="aurora-bg"></div>
        <div class="video-wrapper">
            <video id="santaVideo" playsinline webkit-playsinline preload="none" poster="poster_xhgd.jpg">
                <source src="santa_video.mp4" type="video/mp4">
            </video>
        </div>
        <div style="text-align: center; padding: 0 20px;">
            <div class="gold-text">åœ£è¯å¿«ä¹</div>
            <div class="sub-text">Encrypted Signal Verified</div>
            <button class="skip-btn" onclick="navTo('certificate.html')">è·³è¿‡è§†é¢‘ï¼Œç›´æ¥é¢†å–è¯ä¹¦ &rarr;</button>
        </div>
    </div>

    <div class="magic-dock">
        <a href="javascript:navTo('certificate.html')" class="dock-btn">ğŸ“œ</a>
        <a href="javascript:navTo('mission.html')" class="dock-btn">ğŸ’Œ</a>
        <a href="javascript:navTo('magic.html')" class="dock-btn">âœ¨</a>
    </div>

    <audio id="bgm" preload="none" loop><source src="bgm.mp3" type="audio/mp3"></audio>

    <script>
        // å‚æ•°è·å–
        const params = new URLSearchParams(window.location.search);
        const name = params.get('name') || 'å®è´';
        const lang = params.get('lang') || 'zh';

        // åŠ¨æ€ä¿®æ”¹å¼€åœºç™½ (å¦‚æœJSè¿è¡Œå¾—è¶³å¤Ÿå¿«)
        const textBox = document.getElementById('typewriter-area');
        if(textBox) {
            textBox.innerHTML = `SYSTEM ID: 2025-XHGD<br>To: ${name}<br>æ£€æµ‹åˆ°åŒ—æä¿¡å·...<br>Ready.<br><span class="cursor"></span>`;
        }

        window.navTo = function(page) {
            window.location.href = `${page}?name=${encodeURIComponent(name)}&lang=${lang}`;
        }

        // æ ¸å¿ƒè§£é”åŠŸèƒ½
        window.unlockSystem = function() {
            const intro = document.getElementById('cinema-intro');
            const stage = document.getElementById('main-stage');
            const video = document.getElementById('santaVideo');
            const bgm = document.getElementById('bgm');

            // 1. UI åˆ‡æ¢ (åŸç”ŸJSï¼Œä¸ä¾èµ– GSAP)
            intro.style.opacity = '0';
            intro.style.pointerEvents = 'none';
            setTimeout(() => { intro.style.display = 'none'; }, 1000);

            stage.style.display = 'block';
            // å¼ºåˆ¶é‡ç»˜ triggering reflow
            void stage.offsetWidth; 
            stage.style.opacity = '1';

            // 2. æ’­æ”¾åª’ä½“
            bgm.volume = 0.3;
            bgm.play().catch(() => {}); // å¿½ç•¥è‡ªåŠ¨æ’­æ”¾å¤±è´¥
            video.play().catch(() => { video.controls = true; });

            // 3. è§†é¢‘ç»“æŸåè·³è½¬
            video.onended = () => {
                setTimeout(() => navTo('certificate.html'), 500);
            }

            // 4. [é«˜çº§] åŠ¨æ€åŠ è½½ 3D æå…‰ (ç‚¹å‡»åæ‰å»ä¸‹è½½åº“)
            loadAuroraEffect();
        }
    </script>

    <script src="https://cdn.bootcdn.net/ajax/libs/tailwindcss/3.3.3/cdn.min.js" defer></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/gsap/3.12.2/gsap.min.js" defer></script>

    <script>
        function loadAuroraEffect() {
            // åŠ¨æ€åˆ›å»ºä¸€ä¸ª module script
            const script = document.createElement('script');
            script.type = 'module';
            script.textContent = `
                import { Renderer, Program, Mesh, Triangle } from 'https://unpkg.com/ogl@1.0.11/dist/ogl.mjs';
                
                try {
                    const ctn = document.getElementById('aurora-bg');
                    const renderer = new Renderer({alpha: true, dpr: 1});
                    const gl = renderer.gl; 
                    ctn.appendChild(gl.canvas);
                    
                    const program = new Program(gl, {
                        vertex: '#version 300 es\\n in vec2 position; void main(){ gl_Position = vec4(position, 0.0, 1.0); }',
                        fragment: '#version 300 es\\n precision highp float; uniform float uTime; uniform vec2 uResolution; out vec4 fragColor; float random (in vec2 st) { return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123); } float noise (in vec2 st) { vec2 i = floor(st); vec2 f = fract(st); float a = random(i); float b = random(i + vec2(1.0, 0.0)); float c = random(i + vec2(0.0, 1.0)); float d = random(i + vec2(1.0, 1.0)); vec2 u = f * f * (3.0 - 2.0 * f); return mix(a, b, u.x) + (c - a)* u.y * (1.0 - u.x) + (d - b) * u.x * u.y; } void main() { vec2 uv = gl_FragCoord.xy / uResolution; float n = noise(uv * 3.0 + vec2(uTime * 0.1, uTime * 0.2)); float alpha = smoothstep(0.4, 0.8, n); vec3 color = vec3(0.05, 0.4, 0.3); fragColor = vec4(color, alpha * 0.3); }',
                        uniforms: { uTime: { value: 0 }, uResolution: { value: [window.innerWidth, window.innerHeight] } }
                    });
                    
                    const mesh = new Mesh(gl, { geometry: new Triangle(gl), program });
                    function resize() { renderer.setSize(window.innerWidth, window.innerHeight); program.uniforms.uResolution.value = [window.innerWidth, window.innerHeight]; }
                    window.addEventListener('resize', resize); resize();
                    requestAnimationFrame(function update(t) { program.uniforms.uTime.value = t * 0.001; renderer.render({ scene: mesh }); requestAnimationFrame(update); });
                } catch(e) { console.log('Aurora skipped'); }
            `;
            document.body.appendChild(script);
        }
    </script>
</body>
</html>
