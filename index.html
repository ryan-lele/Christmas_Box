<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>North Pole Connection Terminal</title>
    
    <link rel="prefetch" href="certificate.html">
    <link rel="prefetch" href="mission.html">
    <link rel="prefetch" href="magic.html">

    <script src="https://cdn.bootcdn.net/ajax/libs/tailwindcss/3.3.3/cdn.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
    <link href="https://fonts.loli.net/css2?family=Cinzel:wght@700&family=Noto+Serif+SC:wght@300;700&family=Ma+Shan+Zheng&family=Special+Elite&display=swap" rel="stylesheet">
    
    <style>
        /* --- åŸºç¡€è®¾å®š --- */
        body { 
            background-color: #020617; 
            color: #fff; 
            margin: 0; 
            /* âš¡ï¸ [æ ¸å¿ƒä¼˜åŒ– 3] å…¼å®¹ç§»åŠ¨ç«¯åº•éƒ¨æ  */
            min-height: 100vh;
            min-height: 100dvh; 
            overflow-x: hidden; 
            font-family: 'Noto Serif SC', serif;
            -webkit-font-smoothing: antialiased;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- é¡¶éƒ¨å“ç‰Œæ  --- */
        .brand-bar {
            position: fixed;
            top: 0; left: 0; right: 0;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            background: linear-gradient(to bottom, rgba(2,6,23,0.9), transparent);
            pointer-events: none;
        }
        .brand-logo {
            font-family: 'Cinzel', serif;
            color: #fbbf24;
            font-size: 1.2rem;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
            font-weight: bold;
        }

        /* --- è§†è§‰ç‰¹æ•ˆï¼šé»‘é‡‘æµå…‰å­— --- */
        .gold-text {
            background: linear-gradient(135deg, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            -webkit-background-clip: text; 
            background-clip: text; 
            color: transparent;
            text-shadow: 0 0 30px rgba(251, 191, 36, 0.3);
            background-size: 200% auto; 
            animation: shine 5s linear infinite;
        }
        @keyframes shine { to { background-position: 200% center; } }

        /* --- å¼€åœºå¹•å¸ƒ (Intro Layer) --- */
        #cinema-intro {
            position: fixed; 
            inset: 0; 
            background: #020617; 
            z-index: 9999;
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center;
            padding: 40px; 
            text-align: center; 
            cursor: pointer;
        }
        
        /* æ‰“å­—æœºæ–‡å­—æ ·å¼ */
        .intro-text {
            font-family: 'Special Elite', monospace; 
            color: #fbbf24; 
            font-size: 1.1rem; 
            line-height: 1.8;
            text-shadow: 0 0 10px rgba(251, 191, 36, 0.5); 
            min-height: 150px;
            max-width: 600px;
            text-align: left;
            margin-bottom: 40px;
        }

        /* è§£å°æŒ‰é’® */
        .decrypt-btn { 
            opacity: 0; 
            background: transparent;
            color: #fbbf24; 
            font-family: 'Cinzel', serif;
            font-size: 1rem; 
            letter-spacing: 2px; 
            text-transform: uppercase; 
            border: 1px solid rgba(251, 191, 36, 0.4); 
            padding: 16px 32px; 
            border-radius: 4px;
            transition: 0.3s;
            position: relative;
            overflow: hidden;
        }
        .decrypt-btn::before {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(251, 191, 36, 0.2), transparent);
            animation: scan 3s infinite;
        }
        @keyframes scan { 0% {left: -100%} 100% {left: 200%} }

        /* --- ä¸»èˆå° (Main Stage) --- */
        #main-stage { opacity: 0; transition: opacity 2s; position: relative; z-index: 10; padding-top: 70px; }
        
        /* æå…‰èƒŒæ™¯å®¹å™¨ */
        #aurora-bg { position: fixed; inset: 0; z-index: -2; opacity: 0.6; pointer-events: none; }
        
        /* --- è§†é¢‘åŒºåŸŸ (Cä½) --- */
        .video-wrapper {
            width: 100%;
            max-width: 450px; 
            margin: 0 auto 30px auto;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 0 40px rgba(251, 191, 36, 0.2);
            border: 1px solid rgba(251, 191, 36, 0.3);
            position: relative;
            aspect-ratio: 9/16;
            background: #000;
        }
        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        /* --- åº•éƒ¨æ–‡å­— --- */
        .main-content {
            text-align: center;
            padding: 0 20px 50px 20px;
        }

        /* --- é­”æ³•å¯¼èˆªå (Side Dock) --- */
        .magic-dock { 
            position: fixed; right: 20px; bottom: 40px; 
            display: flex; flex-direction: column; gap: 15px; z-index: 5000; 
        }
        .dock-btn {
            width: 44px; height: 44px; border-radius: 50%; 
            display: flex; justify-content: center; align-items: center; font-size: 1.2rem;
            color: #fbbf24; text-decoration: none; transition: all 0.3s;
            background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px);
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        /* åŠ¨ç”»å®šä¹‰ */
        @keyframes fall { to { transform: translateY(110vh); } }
        .snowflake { position: absolute; background: white; border-radius: 50%; opacity: 0.8; animation: fall linear infinite; pointer-events: none; }
    </style>
</head>
<body>

    <audio id="bgm" loop>
        <source src="bgm.mp3" type="audio/mp3">
    </audio>

    <div class="brand-bar">
        <div class="brand-logo">XHGD Â· SNOWFLAKE KINGDOM</div>
    </div>

    <div class="magic-dock">
        <a href="javascript:navTo('certificate.html')" class="dock-btn" title="è¯ä¹¦">ğŸ“œ</a>
        <a href="javascript:navTo('mission.html')" class="dock-btn" title="ä»»åŠ¡">ğŸ’Œ</a>
        <a href="javascript:navTo('magic.html')" class="dock-btn" title="é­”æ³•">âœ¨</a>
    </div>

    <div id="cinema-intro">
        <div class="intro-text" id="typewriter-area"></div>
        <button class="decrypt-btn" id="tap-hint">
            â–¼ TAP TO DECRYPT <br> <span style="font-size:0.8rem; opacity:0.8">ç‚¹å‡»è§£å°åŒ—æå¯†è®¯</span>
        </button>
    </div>

    <div id="main-stage">
        <div id="aurora-bg"></div>
        <div id="snow-container"></div>

        <div class="video-wrapper">
            <video id="santaVideo" playsinline poster="poster_xhgd.jpg" webkit-playsinline>
                <source src="santa_video.mp4" type="video/mp4">
            </video>
        </div>

        <div class="main-content">
            <h1 class="text-4xl font-bold mb-2 gold-text" style="font-family: 'Ma Shan Zheng', cursive;">åœ£è¯å¿«ä¹</h1>
            <div class="text-xs tracking-[0.3em] text-yellow-100/60 mb-8 font-serif uppercase">
                Encrypted Signal Verified
            </div>
            
            <button onclick="navTo('certificate.html')" class="text-yellow-500 border-b border-yellow-500 pb-1 text-sm opacity-60">
                è·³è¿‡è§†é¢‘ï¼Œç›´æ¥é¢†å–è¯ä¹¦ &rarr;
            </button>
        </div>
    </div>

    <script type="module">
        // ğŸ› ï¸ [ä¿®å¤] æ›¿æ¢ä¸º unpkg ç¨³å®šæºï¼Œé˜²æ­¢ WebGL æå…‰èƒŒæ™¯åŠ è½½å¤±è´¥
        import { Renderer, Program, Mesh, Color, Triangle } from 'https://unpkg.com/ogl/dist/ogl.mjs';
        
        // --- 1. å‚æ•°ç³»ç»Ÿ ---
        const params = new URLSearchParams(window.location.search);
        const name = params.get('name') || 'å®è´'; 
        const lang = params.get('lang') || 'zh';
        window.navTo = function(page) {
            window.location.href = `${page}?name=${encodeURIComponent(name)}&lang=${lang}`;
        }

        // --- 2. æ–‡æœ¬å†…å®¹ ---
        const introText = `SYSTEM ID: 2025-XHGD\nTo: ${name}\n\næ£€æµ‹åˆ°åŠ å¯†çš„åŒ—æä¿¡å·...\næ¥æºï¼šSnowflake Kingdom (é›ªèŠ±å›½åº¦)\n\nè¯·æ±‚æ¥å…¥è®¸å¯...`;

        // --- 3. æ‰“å­—æœºé€»è¾‘ ---
        const typeArea = document.getElementById('typewriter-area');
        const hintBtn = document.getElementById('tap-hint');
        let charIndex = 0;
        
        function typeWriter() {
            if (charIndex < introText.length) {
                const char = introText.charAt(charIndex);
                typeArea.innerHTML += char === '\n' ? '<br>' : char;
                charIndex++;
                setTimeout(typeWriter, 40);
            } else {
                gsap.to(hintBtn, {opacity: 1, duration: 1});
            }
        }
        setTimeout(typeWriter, 500);

        // --- 4. æ ¸å¿ƒäº¤äº’ (ç‚¹å‡»è§£å°) ---
        const santaVideo = document.getElementById('santaVideo');
        const bgm = document.getElementById('bgm');

        // è§†é¢‘æ’­æ”¾ç»“æŸç›‘å¬ -> è‡ªåŠ¨è·³è½¬
        santaVideo.addEventListener('ended', () => {
            setTimeout(() => {
                navTo('certificate.html');
            }, 800);
        });

        hintBtn.addEventListener('click', () => {
            // A. æ’­æ”¾BGM
            bgm.volume = 0.3; 
            bgm.play().catch(e => console.log('Audio play failed', e));

            // B. è½¬åœºåŠ¨ç”»
            gsap.to("#cinema-intro", { 
                opacity: 0, duration: 1, pointerEvents: "none",
                onComplete: () => { document.getElementById('cinema-intro').style.display = 'none'; }
            });
            gsap.to("#main-stage", { opacity: 1, duration: 1.5 });
            
            // C. å¯åŠ¨æå…‰
            initAurora();

            // D. æ’­æ”¾è§†é¢‘
            setTimeout(() => {
                santaVideo.play().then(() => {
                }).catch(e => {
                    santaVideo.controls = true;
                });
            }, 500);
        });

        // --- 5. æå…‰èƒŒæ™¯ (WebGL) ---
        function initAurora() {
            const ctn = document.getElementById('aurora-bg');
            if(ctn.children.length > 0) return;
            const renderer = new Renderer({alpha: true, dpr: 1});
            const gl = renderer.gl; 
            ctn.appendChild(gl.canvas);
            const program = new Program(gl, {
                vertex: `#version 300 es
                in vec2 position; void main(){ gl_Position = vec4(position, 0.0, 1.0); }`,
                fragment: `#version 300 es
                precision highp float; uniform float uTime; uniform vec2 uResolution; out vec4 fragColor;
                float random (in vec2 st) { return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123); }
                float noise (in vec2 st) { vec2 i = floor(st); vec2 f = fract(st); float a = random(i); float b = random(i + vec2(1.0, 0.0)); float c = random(i + vec2(0.0, 1.0)); float d = random(i + vec2(1.0, 1.0)); vec2 u = f * f * (3.0 - 2.0 * f); return mix(a, b, u.x) + (c - a)* u.y * (1.0 - u.x) + (d - b) * u.x * u.y; }
                void main() {
                    vec2 uv = gl_FragCoord.xy / uResolution;
                    float n = noise(uv * 3.0 + vec2(uTime * 0.1, uTime * 0.2));
                    float alpha = smoothstep(0.4, 0.8, n);
                    vec3 color = vec3(0.05, 0.4, 0.3); // æ·±ç»¿æå…‰
                    fragColor = vec4(color, alpha * 0.3); 
                }`,
                uniforms: { uTime: { value: 0 }, uResolution: { value: [window.innerWidth, window.innerHeight] } }
            });
            const mesh = new Mesh(gl, { geometry: new Triangle(gl), program });
            function resize() { renderer.setSize(window.innerWidth, window.innerHeight); program.uniforms.uResolution.value = [window.innerWidth, window.innerHeight]; }
            window.addEventListener('resize', resize); resize();
            requestAnimationFrame(function update(t) { program.uniforms.uTime.value = t * 0.001; renderer.render({ scene: mesh }); requestAnimationFrame(update); });
        }
        
        // --- 6. é›ªèŠ± ---
        const snowCtn = document.getElementById('snow-container');
        setInterval(() => {
            if(document.hidden) return;
            const f = document.createElement('div'); f.className = 'snowflake';
            const s = Math.random() * 3 + 2 + 'px';
            f.style.width = s; f.style.height = s; f.style.left = Math.random() * 100 + 'vw';
            f.style.animationDuration = Math.random() * 5 + 5 + 's'; f.style.opacity = Math.random() * 0.5 + 0.3;
            snowCtn.appendChild(f);
            setTimeout(() => f.remove(), 10000);
        }, 300);
    </script>
</body>
</html>
