<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>North Pole Connection Terminal</title>
    
    <script src="https://cdn.bootcdn.net/ajax/libs/tailwindcss/3.3.3/cdn.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Noto+Serif+SC:wght@300;700&family=Ma+Shan+Zheng&family=Special+Elite&display=swap" rel="stylesheet">
    
    <style>
        /* --- åŸºç¡€è®¾å®š --- */
        body { 
            background-color: #020617; 
            color: #fff; 
            margin: 0; 
            overflow-x: hidden; 
            font-family: 'Noto Serif SC', serif;
            -webkit-font-smoothing: antialiased;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- è§†è§‰ç‰¹æ•ˆï¼šé»‘é‡‘æµå…‰å­— --- */
        .gold-text {
            background: linear-gradient(135deg, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            -webkit-background-clip: text; 
            background-clip: text; 
            color: transparent;
            text-shadow: 0 0 30px rgba(251, 191, 36, 0.3);
            background-size: 200% auto; 
            animation: shine 5s linear infinite;
        }
        @keyframes shine { to { background-position: 200% center; } }

        /* --- å¼€åœºå¹•å¸ƒ (Intro Layer) --- */
        #cinema-intro {
            position: fixed; 
            inset: 0; 
            background: #020617; 
            z-index: 9999;
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center;
            padding: 40px; 
            text-align: center; 
            cursor: pointer;
        }
        
        /* æ‰“å­—æœºæ–‡å­—æ ·å¼ */
        .intro-text {
            font-family: 'Special Elite', monospace; 
            color: #fbbf24; 
            font-size: 1.1rem; 
            line-height: 1.8;
            text-shadow: 0 0 10px rgba(251, 191, 36, 0.5); 
            min-height: 200px;
            max-width: 600px;
            text-align: left;
        }

        .tap-hint { 
            margin-top: 40px; 
            opacity: 0; 
            color: #94a3b8; 
            font-size: 0.9rem; 
            letter-spacing: 2px; 
            text-transform: uppercase; 
            animation: pulse 2s infinite; 
            border: 1px solid rgba(255,255,255,0.2); 
            padding: 10px 24px; 
            border-radius: 99px;
            transition: 0.3s;
        }
        .tap-hint:hover { background: rgba(251, 191, 36, 0.1); border-color: #fbbf24; }
        
        /* --- ä¸»èˆå° (Main Stage) --- */
        #main-stage { opacity: 0; transition: opacity 2s; position: relative; z-index: 10; }
        
        /* æå…‰èƒŒæ™¯å®¹å™¨ */
        #aurora-bg { position: fixed; inset: 0; z-index: -2; opacity: 0.6; pointer-events: none; }
        
        /* --- é­”æ³•å¯¼èˆªå (Side Dock) --- */
        .magic-dock { 
            position: fixed; right: 20px; top: 50%; transform: translateY(-50%); 
            display: flex; flex-direction: column; gap: 20px; z-index: 5000; 
        }
        .dock-btn {
            width: 48px; height: 48px; border-radius: 50%; 
            display: flex; justify-content: center; align-items: center; font-size: 1.5rem;
            color: #fbbf24; text-decoration: none; transition: all 0.3s;
            background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(8px);
            border: 1px solid rgba(251, 191, 36, 0.3); box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }
        .dock-btn:active { transform: scale(0.9); background: rgba(251, 191, 36, 0.2); }
        
        /* --- æ ¸å¿ƒæŒ‰é’® (Hero Button) --- */
        .hero-btn {
            position: relative; overflow: hidden;
            padding: 18px 48px; border-radius: 99px;
            background: linear-gradient(to bottom, #1e293b, #0f172a);
            border: 1px solid rgba(251, 191, 36, 0.5);
            color: #fbbf24; font-family: 'Cinzel', serif; font-weight: bold; font-size: 1.2rem;
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.15); transition: transform 0.2s;
            cursor: pointer;
        }
        .hero-btn:active { transform: scale(0.95); }

        /* --- åº•éƒ¨è§†é¢‘åŒºåŸŸ --- */
        .footer { 
            margin-top: 20vh; /* è°ƒæ•´é—´è· */
            padding: 50px 20px 100px 20px; 
            background: linear-gradient(to top, #020617 20%, transparent); 
            text-align: center; 
        }
        .video-box { 
            border: 1px solid rgba(251, 191, 36, 0.3); 
            border-radius: 12px; 
            overflow: hidden; 
            max-width: 600px; 
            margin: 0 auto; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.8); 
            background: #000;
        }

        /* åŠ¨ç”»å®šä¹‰ */
        @keyframes pulse { 0%, 100% {opacity: 0.3;} 50% {opacity: 1;} }
        @keyframes fall { to { transform: translateY(110vh); } }
        .snowflake { position: absolute; background: white; border-radius: 50%; opacity: 0.8; animation: fall linear infinite; pointer-events: none; }
    </style>
</head>
<body>

    <div class="magic-dock">
        <a href="javascript:navTo('certificate.html')" class="dock-btn" title="è£èª‰è¯ä¹¦">ğŸ“œ</a>
        <a href="javascript:navTo('mission.html')" class="dock-btn" title="ç»å¯†ä»»åŠ¡">ğŸ’Œ</a>
        <a href="javascript:navTo('magic.html')" class="dock-btn" title="é­”æ³•ä¸­å¿ƒ">ğŸ„</a>
    </div>

    <div id="cinema-intro">
        <div class="intro-text" id="typewriter-area"></div>
        <div class="tap-hint" id="tap-hint">ğŸ‘† ç‚¹å‡»å±å¹• æ¥å…¥ä¿¡å·</div>
    </div>

    <div id="main-stage">
        <div id="aurora-bg"></div>
        <div id="snow-container"></div>

        <div class="min-h-screen flex flex-col justify-center items-center p-6 relative z-10">
            <h1 class="text-6xl md:text-8xl font-bold mb-4 gold-text" style="font-family: 'Ma Shan Zheng', cursive;">åœ£è¯å¿«ä¹</h1>
            <div class="text-sm tracking-[0.5em] text-yellow-100/60 mb-12 font-serif uppercase">The Snowflake Kingdom</div>
            
            <button onclick="navTo('certificate.html')" class="hero-btn">
                å¼€å¯æ—…ç¨‹
            </button>
            
            <div class="absolute bottom-10 animate-bounce opacity-50 text-yellow-500">
                â†“ ä¸‹æ»‘æŸ¥çœ‹è§†é¢‘ä¿¡ä»¶
            </div>
        </div>

        <div class="footer">
            <p class="text-slate-500 text-xs tracking-widest mb-4">ENCRYPTED SIGNAL FROM NORTH POLE</p>
            <div class="video-box">
                <video controls playsinline width="100%" poster="https://img.freepik.com/free-photo/christmas-background-with-bokeh-lights_23-2148116527.jpg">
                    <source src="santa_video.mp4" type="video/mp4">
                    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
                </video>
            </div>
            <p class="text-slate-600 text-xs mt-4">SYSTEM ID: 2025-XMAS-OP</p>
        </div>
    </div>

    <script type="module">
        import { Renderer, Program, Mesh, Color, Triangle } from 'https://cdn.skypack.dev/ogl';
        
        // --- 1. å‚æ•°è§£æä¸å¯¼èˆªç³»ç»Ÿ ---
        const params = new URLSearchParams(window.location.search);
        // å¦‚æœURLæ²¡æœ‰åå­—ï¼Œé»˜è®¤ä¸ºâ€œå®è´â€
        const name = params.get('name') || 'å®è´'; 
        const lang = params.get('lang') || 'zh';

        // æŒ‚è½½åˆ° window å¯¹è±¡ä¾› HTML onclick è°ƒç”¨
        window.navTo = function(page) {
            window.location.href = `${page}?name=${encodeURIComponent(name)}&lang=${lang}`;
        }

        // --- 2. è¯­éŸ³åˆæˆç³»ç»Ÿ (Text to Speech) ---
        const synth = window.speechSynthesis;
        function speak(text) {
            // åœæ­¢ä¹‹å‰çš„æ’­æ”¾
            synth.cancel(); 
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang === 'zh' ? 'zh-CN' : 'en-US';
            utterance.rate = 0.9; // è¯­é€Ÿç¨å¾®æ…¢ä¸€ç‚¹ï¼Œæ›´æœ‰ä»ªå¼æ„Ÿ
            utterance.pitch = 1.0;
            synth.speak(utterance);
        }

        // --- 3. æ–‡æ¡ˆé…ç½® ---
        const introText = lang === 'zh' 
            ? `äº²çˆ±çš„ ${name}ï¼š\n\næˆ‘æ˜¯æ¥è‡ªåŒ—æçš„ä¿¡ä½¿ã€‚\nç›‘æµ‹åˆ°ä½ åœ¨2025å¹´çš„ä¼˜å¼‚è¡¨ç°ï¼Œ\nåœ£è¯è€äººç‰¹æ´¾æˆ‘ä¸ºä½ é€æ¥ç¤¼ç‰©ã€‚\n\nå‡†å¤‡å¥½è¿›å…¥é›ªèŠ±å›½åº¦äº†å—ï¼Ÿ` 
            : `Dear ${name},\nMessenger from North Pole here.\nWe detected your amazing spirit in 2025!\nA gift awaits you.\nReady to enter the Snowflake Kingdom?`;
        
        const audioText = lang === 'zh' 
            ? `äº²çˆ±çš„${name}ï¼Œåœ£è¯å¿«ä¹ã€‚æˆ‘æ˜¯æ¥è‡ªåŒ—æçš„ä¿¡ä½¿ã€‚ç›‘æµ‹åˆ°ä½ åœ¨2025å¹´çš„ä¼˜å¼‚è¡¨ç°ï¼Œç‰¹æ¥ç»™ä½ èµ é€åœ£è¯ç¤¼ç‰©ã€‚å‡†å¤‡å¥½è¿›å…¥é›ªèŠ±å›½åº¦äº†å—ï¼Ÿ`
            : `Hello ${name}, Merry Christmas. I am the messenger from the North Pole. Ready for your gift?`;

        // --- 4. æ‰“å­—æœºç‰¹æ•ˆé€»è¾‘ ---
        const typeArea = document.getElementById('typewriter-area');
        const hint = document.getElementById('tap-hint');
        let charIndex = 0;
        
        function typeWriter() {
            if (charIndex < introText.length) {
                const char = introText.charAt(charIndex);
                typeArea.innerHTML += char === '\n' ? '<br>' : char;
                charIndex++;
                // æ‰“å­—é€Ÿåº¦éšæœºåŒ–ï¼Œæ¨¡æ‹ŸçœŸå®æ‰“å­—
                setTimeout(typeWriter, Math.random() * 50 + 50);
            } else {
                // æ‰“å­—ç»“æŸï¼Œæ˜¾ç¤ºæç¤ºæŒ‰é’®
                hint.style.opacity = 1;
            }
        }
        // å»¶è¿Ÿ500mså¼€å§‹æ‰“å­—
        setTimeout(typeWriter, 500);

        // --- 5. æ ¸å¿ƒäº¤äº’ï¼šç”¨æˆ·ç‚¹å‡» (è§£é”éŸ³é¢‘ & è½¬åœº) ---
        // å¿…é¡»é€šè¿‡ç”¨æˆ·äº¤äº’æ‰èƒ½åœ¨iOSä¸Šæ’­æ”¾å£°éŸ³å’Œè§†é¢‘
        document.getElementById('cinema-intro').addEventListener('click', () => {
            
            // A. è§£é”éŸ³é¢‘ä¸Šä¸‹æ–‡
            const unlock = new SpeechSynthesisUtterance('');
            synth.speak(unlock);

            // B. æ’­æ”¾æ¬¢è¿è¯­
            setTimeout(() => {
                speak(audioText);
            }, 300);

            // C. è§†è§‰è½¬åœºåŠ¨ç”» (GSAP)
            gsap.to("#cinema-intro", { 
                opacity: 0, 
                duration: 1.5, 
                pointerEvents: "none",
                onComplete: () => { document.getElementById('cinema-intro').style.display = 'none'; }
            });
            gsap.to("#main-stage", { opacity: 1, duration: 2, delay: 0.5 });
            
            // D. å¯åŠ¨æå…‰ WebGL
            initAurora();
        });

        // --- 6. æå…‰èƒŒæ™¯ç‰¹æ•ˆ (WebGL) ---
        function initAurora() {
            const ctn = document.getElementById('aurora-bg');
            if(ctn.children.length > 0) return; // é˜²æ­¢é‡å¤åˆ›å»º
            
            const renderer = new Renderer({alpha: true, dpr: 1}); // dpr:1 æå‡æ€§èƒ½
            const gl = renderer.gl; 
            ctn.appendChild(gl.canvas);
            
            // ç®€å•çš„å™ªå£°ç€è‰²å™¨
            const program = new Program(gl, {
                vertex: `#version 300 es
                in vec2 position;
                void main(){ gl_Position = vec4(position, 0.0, 1.0); }`,
                fragment: `#version 300 es
                precision highp float;
                uniform float uTime;
                uniform vec2 uResolution;
                out vec4 fragColor;
                
                // ä¼ªéšæœºå‡½æ•°
                float random (in vec2 st) {
                    return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
                }
                
                // å™ªå£°å‡½æ•°
                float noise (in vec2 st) {
                    vec2 i = floor(st);
                    vec2 f = fract(st);
                    float a = random(i);
                    float b = random(i + vec2(1.0, 0.0));
                    float c = random(i + vec2(0.0, 1.0));
                    float d = random(i + vec2(1.0, 1.0));
                    vec2 u = f * f * (3.0 - 2.0 * f);
                    return mix(a, b, u.x) + (c - a)* u.y * (1.0 - u.x) + (d - b) * u.x * u.y;
                }

                void main() {
                    vec2 uv = gl_FragCoord.xy / uResolution;
                    // åˆ¶é€ æµåŠ¨çš„æå…‰æ•ˆæœ
                    float n = noise(uv * 3.0 + vec2(uTime * 0.1, uTime * 0.2));
                    float alpha = smoothstep(0.4, 0.8, n);
                    // ç»¿è‰²å¸¦ä¸€ç‚¹è“
                    vec3 color = vec3(0.1, 0.8, 0.6);
                    fragColor = vec4(color, alpha * 0.4); 
                }`,
                uniforms: { 
                    uTime: { value: 0 }, 
                    uResolution: { value: [window.innerWidth, window.innerHeight] } 
                }
            });
            
            const mesh = new Mesh(gl, { geometry: new Triangle(gl), program });
            
            function resize() {
                renderer.setSize(window.innerWidth, window.innerHeight);
                program.uniforms.uResolution.value = [window.innerWidth, window.innerHeight];
            }
            window.addEventListener('resize', resize); 
            resize();
            
            requestAnimationFrame(function update(t) {
                program.uniforms.uTime.value = t * 0.001;
                renderer.render({ scene: mesh });
                requestAnimationFrame(update);
            });
        }
        
        // --- 7. é›ªèŠ±ç²’å­ç³»ç»Ÿ ---
        const snowCtn = document.getElementById('snow-container');
        // æ¯200msç”Ÿæˆä¸€ç‰‡é›ªèŠ±
        setInterval(() => {
            if(document.hidden) return; // é¡µé¢åˆ‡åå°æ—¶ä¸ç”Ÿæˆï¼ŒèŠ‚çœæ€§èƒ½
            const f = document.createElement('div');
            f.className = 'snowflake';
            // éšæœºå¤§å°
            const s = Math.random() * 3 + 2 + 'px';
            f.style.width = s;
            f.style.height = s;
            // éšæœºä½ç½®
            f.style.left = Math.random() * 100 + 'vw';
            // éšæœºä¸‹è½æ—¶é—´ (5s - 10s)
            f.style.animationDuration = Math.random() * 5 + 5 + 's';
            // éšæœºé€æ˜åº¦
            f.style.opacity = Math.random() * 0.5 + 0.3;
            
            snowCtn.appendChild(f);
            
            // 10ç§’åè‡ªåŠ¨åˆ é™¤DOMï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
            setTimeout(() => f.remove(), 10000);
        }, 200);
    </script>
</body>
</html>
