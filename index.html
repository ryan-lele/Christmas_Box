<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>North Pole Connection</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/tailwindcss/3.3.3/cdn.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Noto+Serif+SC:wght@300;700&family=Ma+Shan+Zheng&family=Special+Elite&display=swap" rel="stylesheet">
    
    <style>
        /* --- åŸºç¡€è®¾å®š --- */
        body { 
            background-color: #020617; color: #fff; margin: 0; overflow-x: hidden; 
            font-family: 'Noto Serif SC', serif;
            -webkit-font-smoothing: antialiased;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- è§†è§‰ç‰¹æ•ˆï¼šé»‘é‡‘æµå…‰å­— --- */
        .gold-text {
            background: linear-gradient(135deg, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            -webkit-background-clip: text; background-clip: text; color: transparent;
            text-shadow: 0 0 30px rgba(251, 191, 36, 0.3);
            background-size: 200% auto; animation: shine 5s linear infinite;
        }
        @keyframes shine { to { background-position: 200% center; } }

        /* --- å¼€åœºå¹•å¸ƒ --- */
        #cinema-intro {
            position: fixed; inset: 0; background: #020617; z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 40px; text-align: center; cursor: pointer;
        }
        .intro-text {
            font-family: 'Special Elite', monospace; color: #fbbf24; font-size: 1.2rem; line-height: 2;
            text-shadow: 0 0 10px rgba(251, 191, 36, 0.5); min-height: 180px;
        }
        .tap-hint { 
            margin-top: 40px; opacity: 0; color: #94a3b8; font-size: 0.9rem; 
            letter-spacing: 2px; text-transform: uppercase; animation: pulse 2s infinite; 
            border: 1px solid rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 20px;
        }
        
        /* --- ä¸»èˆå° --- */
        #main-stage { opacity: 0; transition: opacity 2s; }
        #aurora-bg { position: fixed; inset: 0; z-index: -2; opacity: 0.6; pointer-events: none; }
        
        /* --- é­”æ³•å¯¼èˆªå --- */
        .magic-dock { 
            position: fixed; right: 20px; top: 50%; transform: translateY(-50%); 
            display: flex; flex-direction: column; gap: 20px; z-index: 5000; 
        }
        .dock-btn {
            width: 48px; height: 48px; border-radius: 50%; 
            display: flex; justify-content: center; align-items: center; font-size: 1.5rem;
            color: #fbbf24; text-decoration: none; transition: all 0.3s;
            background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(8px);
            border: 1px solid rgba(251, 191, 36, 0.3); box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }
        .dock-btn:active { transform: scale(0.9); background: rgba(251, 191, 36, 0.2); }
        
        /* --- æ ¸å¿ƒæŒ‰é’® --- */
        .hero-btn {
            position: relative; overflow: hidden;
            padding: 18px 48px; border-radius: 99px;
            background: linear-gradient(to bottom, #1e293b, #0f172a);
            border: 1px solid rgba(251, 191, 36, 0.5);
            color: #fbbf24; font-family: 'Cinzel', serif; font-weight: bold; font-size: 1.2rem;
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.15); transition: transform 0.2s;
        }
        .hero-btn:active { transform: scale(0.95); }

        /* åº•éƒ¨è§†é¢‘ */
        .footer { margin-top: 85vh; padding: 50px 20px; background: linear-gradient(to top, #020617 80%, transparent); text-align: center; }
        .video-box { border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; overflow: hidden; max-width: 500px; margin: 0 auto; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }

        @keyframes pulse { 0%, 100% {opacity: 0.3;} 50% {opacity: 1;} }
        @keyframes fall { to { transform: translateY(110vh); } }
        .snowflake { position: absolute; background: white; border-radius: 50%; opacity: 0.8; animation: fall linear infinite; pointer-events: none; }
    </style>
</head>
<body>

    <div class="magic-dock">
        <a href="javascript:navTo('certificate.html')" class="dock-btn">ğŸ“œ</a>
        <a href="javascript:navTo('mission.html')" class="dock-btn">ğŸ’Œ</a>
        <a href="javascript:navTo('magic.html')" class="dock-btn">ğŸ„</a>
    </div>

    <div id="cinema-intro">
        <div class="intro-text" id="typewriter-area"></div>
        <div class="tap-hint" id="tap-hint">ğŸ‘† ç‚¹å‡»å±å¹• æ¥å…¥ä¿¡å·</div>
    </div>

    <div id="main-stage">
        <div id="aurora-bg"></div>
        <div id="snow-container"></div>

        <div class="fixed inset-0 flex flex-col justify-center items-center pointer-events-none p-6">
            <h1 class="text-6xl md:text-8xl font-bold mb-4 gold-text" style="font-family: 'Ma Shan Zheng', cursive;">åœ£è¯å¿«ä¹</h1>
            <div class="text-sm tracking-[0.5em] text-yellow-100/60 mb-12 font-serif uppercase">The Snowflake Kingdom</div>
            
            <button onclick="navTo('certificate.html')" class="hero-btn pointer-events-auto">
                å¼€å¯æ—…ç¨‹
            </button>
        </div>

        <div class="footer">
            <p class="text-slate-500 text-xs tracking-widest mb-4">ENCRYPTED SIGNAL FROM NORTH POLE</p>
            <div class="video-box">
                <video controls playsinline width="100%" poster="poster.jpg">
                    <source src="santa_video.mp4" type="video/mp4">
                </video>
            </div>
        </div>
    </div>

    <script type="module">
        import { Renderer, Program, Mesh, Color, Triangle } from 'https://cdn.skypack.dev/ogl';
        
        // --- å‚æ•°è§£æ ---
        const params = new URLSearchParams(window.location.search);
        const name = params.get('name') || 'å®è´';
        const lang = params.get('lang') || 'zh';

        window.navTo = function(page) {
            window.location.href = `${page}?name=${encodeURIComponent(name)}&lang=${lang}`;
        }

        // --- è¯­éŸ³åˆæˆç³»ç»Ÿ ---
        const synth = window.speechSynthesis;
        function speak(text) {
            synth.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang === 'zh' ? 'zh-CN' : 'en-US';
            utterance.rate = 0.95; 
            utterance.pitch = 1.0;
            synth.speak(utterance);
        }

        // --- æ–‡æœ¬å†…å®¹ ---
        const introText = lang === 'zh' 
            ? `äº²çˆ±çš„ ${name}ï¼š\næˆ‘æ˜¯æ¥è‡ªåŒ—æçš„ä¿¡ä½¿ã€‚\nç›‘æµ‹åˆ°ä½ åœ¨2025å¹´çš„ä¼˜å¼‚è¡¨ç°ï¼Œ\nç‰¹æ¥ç»™ä½ èµ é€åœ£è¯ç¤¼ç‰©ã€‚\nå‡†å¤‡å¥½è¿›å…¥é›ªèŠ±å›½åº¦äº†å—ï¼Ÿ` 
            : `Dear ${name},\nMessenger from North Pole here.\nWe detected your amazing spirit in 2025!\nA gift awaits you.\nReady to enter the Snowflake Kingdom?`;
        
        const audioText = lang === 'zh' 
            ? `äº²çˆ±çš„${name}ï¼Œæˆ‘æ˜¯æ¥è‡ªåŒ—æçš„ä¿¡ä½¿ã€‚ç›‘æµ‹åˆ°ä½ åœ¨2025å¹´çš„ä¼˜å¼‚è¡¨ç°ï¼Œç‰¹æ¥ç»™ä½ èµ é€åœ£è¯ç¤¼ç‰©ã€‚å‡†å¤‡å¥½è¿›å…¥é›ªèŠ±å›½åº¦äº†å—ï¼Ÿ`
            : `Hello ${name}, I am the messenger from the North Pole. Ready for your gift?`;

        // --- æ‰“å­—æœºé€»è¾‘ ---
        const typeArea = document.getElementById('typewriter-area');
        const hint = document.getElementById('tap-hint');
        let i = 0;
        
        function type() {
            if (i < introText.length) {
                const char = introText.charAt(i);
                typeArea.innerHTML += char === '\n' ? '<br>' : char;
                i++;
                setTimeout(type, 80);
            } else {
                hint.style.opacity = 1;
            }
        }
        setTimeout(type, 500);

        // --- æ ¸å¿ƒäº¤äº’ï¼šç‚¹å‡»è§£é”éŸ³é¢‘ & è§†è§‰è½¬åœº ---
        document.getElementById('cinema-intro').addEventListener('click', () => {
            // 1. è§£é” iOS éŸ³é¢‘
            const unlock = new SpeechSynthesisUtterance('');
            synth.speak(unlock);

            // 2. æ’­æ”¾è¯­éŸ³
            setTimeout(() => {
                speak(audioText);
            }, 300);

            // 3. è§†è§‰è½¬åœº
            gsap.to("#cinema-intro", { opacity: 0, duration: 1.5, pointerEvents: "none" });
            gsap.to("#main-stage", { opacity: 1, duration: 1.5, delay: 0.5 });
            
            // 4. å¯åŠ¨æå…‰
            initAurora();
        });

        // --- æå…‰ç‰¹æ•ˆ (è½»é‡ç‰ˆ) ---
        function initAurora() {
            const ctn = document.getElementById('aurora-bg');
            // é˜²æ­¢é‡å¤åˆå§‹åŒ–
            if(ctn.children.length > 0) return;
            
            const renderer = new Renderer({alpha:true}); const gl=renderer.gl; ctn.appendChild(gl.canvas);
            const program = new Program(gl,{
                vertex: `#version 300 es\nin vec2 position;void main(){gl_Position=vec4(position,0.0,1.0);}`,
                fragment: `#version 300 es\nprecision highp float;uniform float uTime;uniform vec2 uResolution;out vec4 fragColor;float snoise(vec2 v){return sin(v.x*10.0+uTime)*cos(v.y*10.0+uTime)*0.5+0.5;}void main(){vec2 uv=gl_FragCoord.xy/uResolution;float alpha=smoothstep(0.3,0.7,snoise(uv*1.5)+0.5);fragColor=vec4(0.0,0.8,0.5,1.0)*alpha*0.3;}`,
                uniforms: { uTime:{value:0}, uResolution:{value:[window.innerWidth, window.innerHeight]} }
            });
            const mesh = new Mesh(gl,{geometry:new Triangle(gl),program});
            function resize(){renderer.setSize(window.innerWidth,window.innerHeight);program.uniforms.uResolution.value=[window.innerWidth,window.innerHeight];}
            window.addEventListener('resize',resize); resize();
            requestAnimationFrame(function update(t){program.uniforms.uTime.value=t*0.0005;renderer.render({scene:mesh});requestAnimationFrame(update);});
        }
        
        // --- é›ªèŠ±ç‰¹æ•ˆ ---
        const snowCtn = document.getElementById('snow-container');
        setInterval(()=>{
            if(document.hidden) return; // é¡µé¢éšè—æ—¶ä¸ç”Ÿæˆ
            const f=document.createElement('div');f.className='snowflake';
            const s=Math.random()*3+2+'px';f.style.width=s;f.style.height=s;
            f.style.left=Math.random()*100+'vw';f.style.animationDuration=Math.random()*5+5+'s';
            snowCtn.appendChild(f);setTimeout(()=>f.remove(),10000);
        },200);
    </script>
</body>
</html>
